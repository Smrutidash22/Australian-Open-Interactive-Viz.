<!DOCTYPE html>

  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/ >
    <title>Australian Open</title>

    <!-- Google fonts -->
    <link href='fonts.css' rel='stylesheet' type='text/css'>
    <link href='Raleway.css' rel='stylesheet' type='text/css'>

    <!-- D3.js -->
    <script src="d3_min.js" charset="utf-8"></script>
    
    <style>
      p {
        font-weight: 600;
        font-size: 16px;
      }
      body {
        font-family: 'Raleway', sans-serif;
        font-size: 11px;
        font-weight: 700;
        fill: #242424;
        text-align: center;
        text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;
        cursor: default;
        width: 100%
      }
      
      .legend {
        font-family: 'Raleway', sans-serif;
        font-weight: 900;
        fill: #333333;
      }
      
      .tooltip {
        fill: #333333;
      }
    </style>
    <style>

.node circle {
  fill: #fff;
  stroke: steelblue;
  stroke-width: 3px;
}

.node text {
  font: 12px sans-serif;
}

.link {
  fill: none;
  stroke: #ccc;
  stroke-width: 2px;
}

</style>
<head>

</head>
<!-- <body style="background-color:#ebf0fa;"> -->
<body>
    
<style>
body {font-family: Arial;}
body {font-family: "Lato", sans-serif;}

.tablinks {
  background-color: #003cb3;
  position: center;
  color: white;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 14px 16px;
  font-size: 17px;
  width: 9%;
}

.tablinks:hover {
  background-color: #000000;
}

/* Style the tab content */
.tabcontent {
  color: white;
  display: none;
  padding: 50px;
  text-align: center;
}
#fixedContainer
{
  position: fixed;
    top: 10%;
    left: 50%;
    margin-right: -50%;
    transform: translate(-50%, -50%);
}



.container{
	position: fixed
  height: 100%;
  width: 100%;
  left: 0;
    top: 0;
  }

p.a {
  font-family: "Times New Roman", sans-serif;
  white-space: nowrap; 
  width: 500px; 
  overflow: hidden;
  text-overflow: clip;
  color: blue;
  font-weight : bold;
  font-size: 50 px;
  text-align: center;
}
      .heading {
        margin: 0 0 50 0;
        text-align: center;
        font: 16px ""Gill Sans"";
        text-shadow: 2px 2px 5px rgb(51,51,255);
        font-size: 3em;
        color: black;
        background-image: rgb(255,255,255);
        padding: 30px;}


</style>
<div class="heading"> Visualization of AUSTRALIAN OPEN Player's Statistics [2004 - 2014]</div>
      

<div class="container" >
      <!-- Top Navigation -->



  <div class="tab">

    <button class="tablinks" value="2004" onclick= "mytry(event,value)">2004</button>
    <button class="tablinks" value="2005" onclick= "mytry(event,value)">2005</button>
    <button class="tablinks" value="2006" onclick= "mytry(event,value)">2006</button>
    <button class="tablinks" value="2007" onclick= "mytry(event,value)">2007</button>
    <button class="tablinks" value="2008" onclick= "mytry(event,value)">2008</button>  
    <button class="tablinks" value="2009" onclick= "mytry(event,value)">2009</button>
    <button class="tablinks" value="2010" onclick= "mytry(event,value)">2010</button>
    <button class="tablinks" value="2011" onclick= "mytry(event,value)">2011</button>
    <button class="tablinks" value="2012" onclick= "mytry(event,value)">2012</button>
    <button class="tablinks" value="2013" onclick= "mytry(event,value)">2013</button>
    <button class="tablinks" value="2014" onclick= "mytry(event,value)">2014</button>


    </div>​​
</div>















  <p id="yearbox" name="years">
  
<!--   <button onclick="myFunction()">Reset</button> -->

</p>
<div class="buffer1" ></div>

<div class="buffer1" ></div>
<div class="buffer1" ></div>

<div class="graphChart" ></div>

<!-- <div class="buffer"></div> -->

<div class="radarChart"></div> 


<!-- load the d3.js library -->	



<script type="text/javascript" src="data.json"></script>


<script src="radarChart.js"></script> 
<script src="d3.v4.min.js"></script>

<script>

// 


function itbegins(d2k){


  // Set the dimensions and margins of the diagram
  var margin = {top: 10, right: 10, bottom: 10, left: 10},
      width = 1200 - margin.left - margin.right,
      height = 43 - margin.top - margin.bottom;

  // append the svg object to the body of the page
  // appends a 'group' element to 'svg'
  // moves the 'group' element to the top left margin
  var svg3 = d3.select(".buffer1").append("svg")
      .attr("class","buffspace")
      .attr("width", width + margin.right + margin.left)
      .attr("height", height + margin.top + margin.bottom)



  margin = {top: 50, right: 90, bottom: 20, left: 145},
      width = 1200 - margin.left - margin.right,
      height = 400 - margin.top - margin.bottom;

  // append the svg object to the body of the page
  // appends a 'group' element to 'svg'
  // moves the 'group' element to the top left margin
  var svg = d3.select(".graphChart").append("svg")
      .attr("class","nodes.graphChart")
      .attr("width", width + margin.right + margin.left)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform", "translate("
            + margin.left + "," + margin.top + ")");
  //d3.select("svg").remove();

  console.log("ok");
    var dupli = [];
    var d2 = {};
    var d2vals1 = {};
    var d2vals2 = {};
    var dv = [];
    var dt1 = [];
    var dt2 = [];

    for(i=0;i<d2k.length;i++){
    d2 = {};
    dv = [];
    dvals1 = [];
    dvals2 = [];
    d2["round"]=d2k[i]["round"];
    d2["year"]=d2k[i]["year"];
    d2["player1"]=d2k[i]["player1"];
    d2["player2"]=d2k[i]["player2"];
    
    dt1 = {};
    dt2 = {};
    dt1["axis"]="First Serve";
    dt1["value"]=d2k[i]["firstServe1"];
    dvals1.push(dt1);
    dt2["axis"]="firstServe";
    dt2["value"]=d2k[i]["firstServe2"];
    dvals2.push(dt2);

    dt1 = {};
    dt2 = {};
    dt1["axis"]="Ace";
    dt1["value"]=d2k[i]["aces1"];
    dvals1.push(dt1);
    dt2["axis"]="ace";
    dt2["value"]=d2k[i]["aces2"];
    dvals2.push(dt2);

    dt1 = {};
    dt2 = {};
    dt1["axis"]="First Point Won";
    dt1["value"]=d2k[i]["firstPointWon1"];
    dvals1.push(dt1);
    dt2["axis"]="firstPointWon";
    dt2["value"]=d2k[i]["firstPointWon2"];
    dvals2.push(dt2);

    dt1 = {};
    dt2 = {};
    dt1["axis"]="Second Point Won";
    dt1["value"]=d2k[i]["secPointWon1"];
    dvals1.push(dt1);
    dt2["axis"]="secPointWon";
    dt2["value"]=d2k[i]["secPointWon2"];
    dvals2.push(dt2);

    dt1 = {};
    dt2 = {};
    dt1["axis"]="Break";
    dt1["value"]=d2k[i]["break1"];
    dvals1.push(dt1);
    dt2["axis"]="break";
    dt2["value"]=d2k[i]["breaks2"];
    dvals2.push(dt2);

    dt1 = {};
    dt2 = {};
    dt1["axis"]="Return";
    dt1["value"]=d2k[i]["return1"];
    dvals1.push(dt1);
    dt2["axis"]="return";
    dt2["value"]=d2k[i]["return2"];
    dvals2.push(dt2);

    dt1 = {};
    dt2 = {};
    dt1["axis"]="net";
    dt1["value"]=d2k[i]["nets1"];
    dvals1.push(dt1);
    dt2["axis"]="net";
    dt2["value"]=d2k[i]["net2"];
    dvals2.push(dt2);

    dt1 = {};
    dt2 = {};
    dt1["axis"]="Total";
    dt1["value"]=d2k[i]["totals1"];
    dvals1.push(dt1);
    dt2["axis"]="total";
    dt2["value"]=d2k[i]["totals2"];
    dvals2.push(dt2);

    dv.push(dvals1,dvals2);
    d2["vals"]=dv;
    dupli.push(d2);
    }

    console.log(dupli.length);


    var ddt = {"Final":[],"semi":[],"quarter":[],"Fourth":[],"Third":[],"Second":[],"First":[]};

    var kkeys = ["Final","semi","quarter","Fourth","Third","Second","First"];

    ddt["Final"].push(dupli[0]);


    for(kk=1;kk<kkeys.length;kk++){  

    for(i=0;i<ddt[kkeys[kk-1]].length;i++){
    for(j=(2**kk)-1;j<2**(kk+1)-1;j++){
    if(dupli[j]["player1"]==ddt[kkeys[kk-1]][i]["player1"]){
    ddt[kkeys[kk]].push(dupli[j]);
    break;
    }
    }
    for(j=(2**kk)-1;j<2**(kk+1)-1;j++){
    if(dupli[j]["player1"]==ddt[kkeys[kk-1]][i]["player2"]){
    ddt[kkeys[kk]].push(dupli[j]);
    break;
    }
    }
    }
  }



  // 


  // BELOW PART TIL PPP}

  // var processed_data = [];
  // var ip = dta;

  console.log(ddt["Fourth"].length);

  var rang = d3.scale.ordinal().range(["green","red"]);
  var fin = 0,
      sem = 0,
      qua = 0,
      fou = 0,
      thi = 0,
      sec = 0,
      fir =0;
        

  // var margin = {top: 100, right: 100, bottom: 100, left: 100},
  //       width = Math.min(700, window.innerWidth - 10) - margin.left - margin.right,
  //       height = Math.min(width, window.innerHeight - margin.top - margin.bottom - 20);


// margin = {top: 10, right: 10, bottom: 10, left: 10},
//       width = 1200 - margin.left - margin.right,
//       // height = 20 - margin.top - margin.bottom;
//       height = 0;

//   // append the svg object to the body of the page
//   // appends a 'group' element to 'svg'
//   // moves the 'group' element to the top left margin
//   var svg2 = d3.select(".buffer").append("svg")
//       .attr("class","buffspace")
//       .attr("width", width + margin.right + margin.left)
//       .attr("height", height + margin.top + margin.bottom)



margin = {top: 20, right: 90, bottom: 30, left: 110},
      width = 1100 - margin.left - margin.right,
      height = 300 - margin.top - margin.bottom;

  var radarChartOptions = {
    w: width,
    h: height,
    margin: margin,
    maxValue: 1.0,
    levels: 5,
    roundStrokes: true,
    color: rang
  };

  // for (i=0;i<ip.length;i++){

  //   tempData = [];
  //   jb = ip[i];
  //   for (key in jb){
  //     temp = {};
  //     temp['axis'] = key;
  //     temp['value'] = jb[key];
  //     tempData.push(temp);
  //   }
  //   processed_data.push(tempData);

  // }


  // PPPPPPPPPPPPPPPPPPPP

  // var processed_data = ddt["Final"][0]["vals"];
  var processed_data = ddt;

  var treeData =
        {
          "name": ddt["Final"][fin++]["player1"],
          "children": [
            { 
              "name": ddt["semi"][sem++]["player1"],
              "children": [
                { "name": ddt["quarter"][qua++]["player1"],
                "children": [
                {"name": ddt["Fourth"][fou++]["player1"],
                  "children": [
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    },
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    }
                    ]
                },
                {"name": ddt["Fourth"][fou++]["player1"],
                  "children": [
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    },
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    }
                  ]
            }
                ] },
                { "name": ddt["quarter"][qua++]["player1"],
                "children": [
                {"name": ddt["Fourth"][fou++]["player1"],
                  "children": [
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    },
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    }
                    ]
                },
                {"name": ddt["Fourth"][fou++]["player1"],
                  "children": [
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    },
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    }
                  ]
            }
                ] }
              ]
            },
            { 
              "name": ddt["semi"][sem++]["player1"],
              "children": [
                { "name": ddt["quarter"][qua++]["player1"],
                "children": [
                {"name": ddt["Fourth"][fou++]["player1"],
                  "children": [
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    },
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    }
                    ]
                },
                {"name": ddt["Fourth"][fou++]["player1"],
                  "children": [
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    },
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    }
                  ]
            }
                ] },
                { "name": ddt["quarter"][qua++]["player1"],
                "children": [
                {"name": ddt["Fourth"][fou++]["player1"],
                  "children": [
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    },
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    }
                    ]
                },
                {"name": ddt["Fourth"][fou++]["player1"],
                  "children": [
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    },
                    {"name": ddt["Third"][thi++]["player1"],
                    "children": [
                      {"name": ddt["Second"][sec++]["player1"]},
                      {"name": ddt["Second"][sec++]["player1"]}
                      ]
                    }
                  ]
            }
                ] }
              ]
            }
          ]
        };

  var i = 0,
      duration = 750,
      root;

  // declares a tree layout and assigns the size
  var treemap = d3.tree().size([height, width]);

  // Assigns parent, children, height, depth
  root = d3.hierarchy(treeData, function(d) { return d.children; });
  root.x0 = height / 2;
  root.y0 = 0;

  // Collapse after the second level
  // root.children.forEach(collapse);

  root.children.forEach(collapse);
  console.log("second")

  update(root);

  console.log("third-late");
// RadarChart(".radarChart", processed_data["Final"][0]["vals"], radarChartOptions);

// Collapse the node and all it's children
function collapse(d) {
  if(d.children) {
    d._children = d.children
    d._children.forEach(collapse)
    d.children = null
  }
}

function update(source) {

  // Assigns the x and y position for the nodes
  var treeData = treemap(root);

  // Compute the new tree layout.
  var nodes = treeData.descendants(),
      links = treeData.descendants().slice(1);

  // Normalize for fixed-depth.
  nodes.forEach(function(d){ d.y = d.depth * 180});

  // ****************** Nodes section ***************************

  // Update the nodes...
  var node = svg.selectAll('g.node')
      .data(nodes, function(d) {return d.id || (d.id = ++i); });

  // Enter any new modes at the parent's previous position.
  var nodeEnter = node.enter().append('g')
      .attr('class', 'node')
      .attr("transform", function(d) {
        return "translate(" + source.y0 + "," + source.x0 + ")";
    })
    .on('click', click);

  // Add Circle for the nodes
  nodeEnter.append('circle')
      .attr('class', 'node')
      .attr('r', 1e-6)
      .style("fill", function(d) {
          return d._children ? "#ffd27f" : "lightgreen";
      });

  // Add labels for the nodes
  nodeEnter.append('text')
      .attr("dy", ".35em")
      .attr("x", function(d) {
          return d.children || d._children ? -13 : 13;
      })
      .attr("text-anchor", function(d) {
          return d.children || d._children ? "end" : "start";
      })
      .text(function(d) { return d.data.name + "(" + (d.depth == 0 ? "Winner" : kkeys[d.depth-1]) + ")" ; })
                  .style('font-family','Raleway')
                  .style('font-weight',700);
            
              // UPDATE
              var nodeUpdate = nodeEnter.merge(node);
            
              // Transition to the proper position for the node
              nodeUpdate.transition()
                .duration(duration)
                .attr("transform", function(d) { 
                    return "translate(" + d.y + "," + d.x + ")";
                 });
            
              // Update the node attributes and st""yle
  nodeUpdate.select('circle.node')
    .attr('r', 7)
    .style("fill", function(d) {
        return d._children ? "#8d9ee9" : "#102a9b";
    })
    .attr('cursor', 'pointer')
    .style('stroke-width',0);


  // Remove any exiting nodes
  var nodeExit = node.exit().transition()
      .duration(duration)
      .attr("transform", function(d) {
          return "translate(" + source.y + "," + source.x + ")";
      })
      .remove();

  // On exit reduce the node circles size to 0
  nodeExit.select('circle')
    .attr('r', 1e-6);

  // On exit reduce the opacity of text labels
  nodeExit.select('text')
    .style('fill-opacity', 1e-6);

  // ****************** links section ***************************

  // Update the links...
  var link = svg.selectAll('path.link')
      .data(links, function(d) { return d.id; });

  // Enter any new links at the parent's previous position.
  var linkEnter = link.enter().insert('path', "g")
      .attr("class", "link")
      .attr('d', function(d){
        var o = {x: source.x0, y: source.y0}
        return diagonal(o, o)
      });

  // UPDATE
  var linkUpdate = linkEnter.merge(link);

  // Transition back to the parent element position
  linkUpdate.transition()
      .duration(duration)
      .attr('d', function(d){ return diagonal(d, d.parent) });

  // Remove any exiting links
  var linkExit = link.exit().transition()
      .duration(duration)
      .attr('d', function(d) {
        var o = {x: source.x, y: source.y}
        return diagonal(o, o)
      })
      .remove();

  // Store the old positions for transition.
  nodes.forEach(function(d){
    d.x0 = d.x;
    d.y0 = d.y;
  });

  // Creates a curved (diagonal) path from parent to the child nodes
  function diagonal(s, d) {

    path = `M ${s.y} ${s.x}
            C ${(s.y + d.y) / 2} ${s.x},
              ${(s.y + d.y) / 2} ${d.x},
              ${d.y} ${d.x}`

    return path
  }

  // Toggle children on click.
  function click(d) {
    // d3.select("svg.nodes").remove();
    if (d.children) {
        d._children = d.children;

        d.children = null;
      } else {
        d.children = d._children;
        d._children = null;
      }

    console.log("d._children",d._children);
    console.log("descendants",d.depth);
    update(d);

  

    retdepth = d.depth;
    var dname;

    if(d._children==null || retdepth==0){
      dname = d["data"]["name"];
    }
    else{
      dname = d["parent"]["data"]["name"]
      retdepth = retdepth - 1;
    }

    for(ij=0;ij<processed_data[kkeys[retdepth]].length;ij++){
      if(processed_data[kkeys[retdepth]][ij]["player1"]==dname){
        break;
      }
    }

    
    console.log("match-level", kkeys[retdepth]);
    // console.log("Name of node", dname);
    console.log("Name of node", d);
    console.log("dataaaa", processed_data);
    
    
    RadarChart(".radarChart", processed_data[kkeys[retdepth]][ij]["vals"], radarChartOptions);
   
    console.log("Values",processed_data[kkeys[retdepth]][ij]["vals"]);

  }
  }
  function initchart(){
      RadarChart(".radarChart", processed_data["Final"][0]["vals"], radarChartOptions);}

  initchart();
}
console.log("first");
itbegins(dta["2004"]);

</script>

    
    <script>
      

      function myFunction(yr){
      d3.select(".radarChart").select("svg").remove();
      d3.select(".graphChart").select("svg").remove();
      // d3.select(".buffer").select("svg").remove();
      d3.select(".buffer1").select("svg").remove();
      itbegins(dta[yr]);
      }

      var categories = document.getElementById("categories");

      var newOption = document.createElement('option');
      newOption.innerHTML = categories.value;

      function mytry(evt,year) {
        yy = this.value
        myFunction(year);
      }

    </script>


</body>